<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radio Bear Indicator (RBI)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .controls {
            margin: 20px 0;
            padding: 15px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        button {
            padding: 10px 20px;
            margin: 0 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        .instructions {
            margin-top: 20px;
            padding: 15px;
            background-color: white;
            border-radius: 10px;
            max-width: 600px;
        }
        
        .instructions h3 {
            color: #333;
            margin-top: 0;
        }
        
        .instructions ul {
            text-align: left;
        }
    </style>
</head>
<body>
    <h1>Radio Bear Indicator (RBI)</h1>
    
    <div class="controls">
        <button onclick="toggleRBI()">Activer/Désactiver RBI</button>
        <button onclick="resetRBI()">Réinitialiser</button>
        <span style="margin-left: 20px; font-weight: bold;">HDG: <span id="hdgValue">0°</span></span>
    </div>
    
    <div id="rbiCanvas"></div>
    
    <div class="instructions">
        <h3>Instructions d'utilisation :</h3>
        <ul>
            <li><strong>Boutons Gauche/Droit</strong> : Ajuster le cap (HDG)</li>
            <li><strong>Flèches du clavier</strong> : ← et → pour ajuster le cap</li>
            <li><strong>Touche R</strong> : Activer/désactiver le RBI</li>
            <li>Les valeurs QDR et QDM sont simulées automatiquement</li>
        </ul>
    </div>

    <script>
        // Variables globales pour RBI
        let imgRBICadre, imgRBIRose, imgRBIFleche;
        let imgVOR2, imgADF1, imgADF2, imgADF3;
        let imgVORBalise, imgNDB;

        // Variables de valeurs pour RBI
        let capRBI, headingRBI, gisementRBI, roseRBI;
        let HDG_RBI = 0;
        let QDR_RBI, QDM_RBI;
        let rotRBI;
        let GT_RBI;
        let DME_RBI;

        // Variables booléennes pour RBI
        let boutonG_RBI = false;
        let boutonD_RBI = false;
        let RBI = true;

        function preload() {
            // Remplacez ces URLs par les chemins de vos images
            imgRBICadre = loadImage("https://via.placeholder.com/400x400/333333/FFFFFF?text=RBI+Cadre");
            imgRBIRose = loadImage("https://via.placeholder.com/350x350/555555/FFFFFF?text=RBI+Rose");
            imgRBIFleche = loadImage("https://via.placeholder.com/50x200/FF0000/FFFFFF?text=Fleche");
            imgVOR2 = loadImage("https://via.placeholder.com/80x80/0000FF/FFFFFF?text=VOR");
            imgADF1 = loadImage("https://via.placeholder.com/80x80/00FF00/FFFFFF?text=ADF");
            
            // Images de secours si les principales ne sont pas disponibles
            imgVORBalise = loadImage("https://via.placeholder.com/60x60/0000FF/FFFFFF?text=VOR");
            imgNDB = loadImage("https://via.placeholder.com/60x60/FF0000/FFFFFF?text=NDB");
        }

        function setup() {
            let canvas = createCanvas(600, 500);
            canvas.parent('rbiCanvas');
            
            // Initialisation des variables RBI
            roseRBI = 0;
            capRBI = 0;
            
            imageMode(CENTER);
            rectMode(CENTER);
            textAlign(CENTER, CENTER);
            
            // Initialiser des valeurs par défaut
            QDR_RBI = 45;
            QDM_RBI = 225;
            DME_RBI = 25;
        }

        function draw() {
            background(220);
            
            if (RBI) {
                afficherRBI();
            } else {
                afficherMessageDesactive();
            }
            
            // Mettre à jour l'affichage HDG
            document.getElementById('hdgValue').textContent = HDG_RBI + '°';
        }

        function afficherRBI() {
            // Fond du RBI
            fill(50);
            stroke(0);
            strokeWeight(2);
            ellipse(width/2, height/2, 400, 400);
            
            // Rose des directions
            push();
            translate(width/2, height/2);
            rotate(radians(roseRBI));
            
            // Dessiner la rose (cercle avec marquages)
            fill(200);
            stroke(0);
            strokeWeight(1);
            ellipse(0, 0, 350, 350);
            
            // Marques de direction
            fill(0);
            noStroke();
            for (let i = 0; i < 36; i++) {
                push();
                rotate(radians(i * 10));
                if (i % 3 === 0) {
                    // Grands traits (30°)
                    rect(0, -160, 4, 20);
                    let angle = (360 - (i * 10)) % 360;
                    push();
                    rotate(radians(-i * 10));
                    textSize(14);
                    text(angle, 0, -130);
                    pop();
                } else if (i % 1 === 0) {
                    // Petits traits (10°)
                    rect(0, -170, 2, 10);
                }
                pop();
            }
            pop();
            
            // Flèche de cap
            push();
            translate(width/2, height/2);
            rotate(radians(capRBI));
            fill(255, 0, 0);
            noStroke();
            triangle(0, -180, -10, -160, 10, -160);
            pop();
            
            // Indicateurs VOR/ADF
            fill(0, 0, 255);
            ellipse(width/2 - 100, height/2 - 100, 60, 60);
            fill(255, 0, 0);
            ellipse(width/2 + 100, height/2 - 100, 60, 60);
            
            // Affichage des valeurs
            fill(255);
            textSize(20);
            textStyle(BOLD);
            
            // HDG au centre
            fill(0);
            textSize(24);
            text("HDG: " + HDG_RBI + "°", width/2, height/2);
            
            // QDR et QDM
            textSize(16);
            text("QDR: " + (QDR_RBI ? QDR_RBI + "°" : "---"), width/2 - 80, height/2 + 180);
            text("QDM: " + (QDM_RBI ? QDM_RBI + "°" : "---"), width/2 + 80, height/2 + 180);
            text("DME: " + (DME_RBI ? DME_RBI + " NM" : "---"), width/2, height/2 + 210);
            
            // Boutons de contrôle
            dessinerBoutonsRBI();
            
            // Aiguilles des indicateurs (simulées)
            dessinerAiguilles();
        }

        function dessinerAiguilles() {
            // Aiguille VOR (bleue)
            push();
            translate(width/2 - 100, height/2 - 100);
            rotate(radians(QDR_RBI - HDG_RBI));
            stroke(0, 0, 255);
            strokeWeight(3);
            line(0, 0, 0, -40);
            pop();
            
            // Aiguille ADF (rouge)
            push();
            translate(width/2 + 100, height/2 - 100);
            rotate(radians(QDM_RBI - HDG_RBI));
            stroke(255, 0, 0);
            strokeWeight(3);
            line(0, 0, 0, -40);
            pop();
        }

        function dessinerBoutonsRBI() {
            // Bouton gauche
            fill(boutonG_RBI ? color(100, 150, 255) : color(200));
            stroke(0);
            strokeWeight(1);
            rect(width/2 - 60, height/2 + 250, 80, 30, 5);
            fill(0);
            noStroke();
            textSize(14);
            text("Gauche", width/2 - 60, height/2 + 250);
            
            // Bouton droit
            fill(boutonD_RBI ? color(100, 150, 255) : color(200));
            stroke(0);
            strokeWeight(1);
            rect(width/2 + 60, height/2 + 250, 80, 30, 5);
            fill(0);
            noStroke();
            text("Droit", width/2 + 60, height/2 + 250);
        }

        function afficherMessageDesactive() {
            fill(0);
            textSize(32);
            text("RBI Désactivé", width/2, height/2);
            textSize(16);
            text("Appuyez sur 'R' ou le bouton pour activer", width/2, height/2 + 40);
        }

        function mousePressed() {
            // Gestion des clics pour RBI
            if (RBI) {
                gererClicsRBI();
            }
        }

        function gererClicsRBI() {
            // Vérifier les boutons de contrôle RBI
            if (mouseX > width/2 - 100 && mouseX < width/2 - 20 && 
                mouseY > height/2 + 235 && mouseY < height/2 + 265) {
                boutonG_RBI = true;
                // Logique pour diminuer le cap
                HDG_RBI = (HDG_RBI - 1 + 360) % 360;
                roseRBI = -HDG_RBI;
                // Mettre à jour les valeurs simulées
                QDR_RBI = (QDR_RBI + 1) % 360;
                QDM_RBI = (QDM_RBI - 1 + 360) % 360;
            }
            
            if (mouseX > width/2 + 20 && mouseX < width/2 + 100 && 
                mouseY > height/2 + 235 && mouseY < height/2 + 265) {
                boutonD_RBI = true;
                // Logique pour augmenter le cap
                HDG_RBI = (HDG_RBI + 1) % 360;
                roseRBI = -HDG_RBI;
                // Mettre à jour les valeurs simulées
                QDR_RBI = (QDR_RBI - 1 + 360) % 360;
                QDM_RBI = (QDM_RBI + 1) % 360;
            }
        }

        function mouseReleased() {
            // Réinitialiser les boutons RBI
            boutonG_RBI = false;
            boutonD_RBI = false;
        }

        function keyPressed() {
            // Gestion des touches pour RBI
            if (keyCode === LEFT_ARROW) {
                HDG_RBI = (HDG_RBI - 1 + 360) % 360;
                roseRBI = -HDG_RBI;
                QDR_RBI = (QDR_RBI + 1) % 360;
                QDM_RBI = (QDM_RBI - 1 + 360) % 360;
            } else if (keyCode === RIGHT_ARROW) {
                HDG_RBI = (HDG_RBI + 1) % 360;
                roseRBI = -HDG_RBI;
                QDR_RBI = (QDR_RBI - 1 + 360) % 360;
                QDM_RBI = (QDM_RBI + 1) % 360;
            }
            
            // Touche pour activer/désactiver RBI
            if (key === 'r' || key === 'R') {
                RBI = !RBI;
            }
        }

        // Fonctions pour l'interface HTML
        function toggleRBI() {
            RBI = !RBI;
        }

        function resetRBI() {
            HDG_RBI = 0;
            roseRBI = 0;
            capRBI = 0;
            QDR_RBI = 45;
            QDM_RBI = 225;
            DME_RBI = 25;
        }

        // Fonction pour définir les valeurs du RBI
        function setValeursRBI(hdg, qdr, qdm, dme) {
            HDG_RBI = hdg;
            QDR_RBI = qdr;
            QDM_RBI = qdm;
            DME_RBI = dme;
            roseRBI = -hdg;
        }
    </script>
</body>
</html>
